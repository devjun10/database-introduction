## 8. 데이터베이스 설계 단계

요구사항을 분석해 데이터베이스에 반영하는 것

<br/><br/>

### 8-1. 개체와 속성 추출

개체는 현실 세계에서 어떤 조직을 운영하는 데 꼭 필요한 것으로 구별되는 모든 것을 의미한다. 이는 저장할 만한 가치가 있는 중요 데이터를 지닌 사람이나 사물 등으로, 개념적 모델링을 하는 데 가장 중요한 요소다.
개체를 추출할 때 의미가 같은 명사가 여러개라면 대표 명사 하나만 선택한다.

<br/><br/>

### 8-2. E-R 다이어그램

개체는 사각형으로, 속성은 타원형으로 표현한다. 키 속성은 이름에 밑줄을 그어 표시한다. ER 다이어그램은 개념적 설계 단계의 결과물인 개념적 스키마다.

<br/><br/>

### 8-3. 관계 추출

관계는 `개체 간의 의미 있는 연관성`을 나타낸다. 이는 일반적으로 요구 사항을 표현한 문장에서 동사로 표현되며, 의미가 같은 동사가 여러 개이면 대표 동사 하나만 선택한다. 관계를 추출한 후에는 추출한 관계에 대한
매핑 카디널리티와 참여 특성을 결정하는데 매핑 카디널리티는 관계를 맺고 있는 두 개체에서 각 개체 인스턴스가 관계를 맺고 있는 상대 개체의 개체 인스턴스 개수를 의미한다.

<br/><br/>

### 8-4. 논리적 설계

E-R 모델에서는 다중 값 속성이나 복합 속성의 표현을 허용하지만, 관계 데이터 모델에서는 다중 값 속성과 복합 속성의 표현을 허용하지 않는다.

<br/><br/>

### 8-5. 릴레이션 스키마 변환 규칙

E-R 다이어그램을 관계 데이터 모델의 릴레이션 스키마로 변환하는 규칙 다섯가지가 존재한다. 릴레이션 스키마 대신 간단히 릴레이션을 사용한다.

<br/><br/>

### 8-5-1. 모든 개체는 릴레이션으로 변환한다.

E-R 다이어그램의 각 개체를 하나의 릴레이션으로 변환한다. 개체가 가지고 있는 속성이 복합 속성인 경우에는 복합 속성을 구성하고 있는 단순 속성만 릴레이션의 속성으로 변환한다. 개체가 가지고 있는 키 속성은
릴레이션의 기본키로 변환한다.

고객 개체가 복합 속성 주소를 가지고 있는 경우, 복합 속성을 구성하고 있는 단순 속성들만 릴레이션의 속성으로 변환해야 한다.

<br/><br/>

### 8-5-2. 다대다 관계는 릴레이션으로 변환한다.

E-R 다이어그램에 있는 다대다 관계를 하나의 릴레이션으로 변환한다. 관계의 이름을 릴레이션의 이름으로 하고 관계의 속성도 릴레이션의 속성으로 그대로 변환한다. 단, 관계를 맺고 있는 개체가 무엇인지는 중요하므로
관계를 맺고 있는 개체들을 규칙1에 따라 변환한 후 이 릴레이션들의 기본키를 관계 릴레이션에 포함시키고 외래키로 지정한 후 관계 릴레이션의 기본키로 지정한다.

개체를 변환한 릴레이션의 기본키를 외래키로 지정할 때는 가져온 기본키들의 이름이 같을 경우 하나는 이름으로 변경해야 한다. 한 릴레이션에 있는 속성은 이름이 모두 달라야 하기 때문이다. 하지만 속성의 이름만 달라질
뿐 속성의 도메인은 변하지 않으므로 외래키로 사용하는 데 문제가 되지 않는다.

<br/><br/>

### 8-5-3. 일대다 관계는 외래키로 표현한다.

E-R 다이어그램에 있는 일대 다 관계는 릴레이션으로 변환하지 않고 외래키로만 표현한다. 단, 약한 개체가 참여하는 일대다 관계는 일반 개체가 참여하는 경우와 다르게 처리해야 하므로 아래 규칙을 적용한다.

<br/>

### 1. 일반적 일대다 관계

1측 개체 릴레이션의 기본키를 가져와 n측 개체 릴레이션에 포함시키고 외래키로 지정한다. 관계의 속성들도 n측 개체 릴레이션에 포함시킨다.

<br/>

### 2. 약한 개체가 참여하는 일대다 관계

1측 개체 릴레이션의 기본키를 가져와 n측 개체 릴레이션에 포함시키고 외래키로 지정한다. 관계의 속성들도 n측 개체 릴레이션에 포함시킨다. n측 개체 릴레이션이 가지고 있던 키 속성과 외래키 속성을 조합하여 기본키로
지정한다. 약한 개체는 강한 개체에 따라 존재여부가 결정되는 만큼 강한 개체의 기본키를 이용해 식별한다. 따라서 강한 개체인 1측 개체 릴레이션의 기본키를 포함해 약한 개체의 기본키를 지정한다.

<br/><br/><br/><br/>

### 8-5-4. 일대일 관계는 외래키로 표현한다.

E-R 다이어그램에 있는 일대일 관계도 일대다 관계처럼 릴레이션으로 변환하지 않고 외래키로만 표현한다. 이때 데이터의 중복을 피하려면 개체가 관계에 참여하는 특성에 따라 약간 다르게 처리해야 한다.

<br/>

### 1. 일반적 일대일 관계는 외래키를 서로 주고 받는다.

일반적인 일대일 관계는 릴레이션으로 변환하지 않고 외래키로만 표현한다. 관계를 맺는 개체들을 규칙1에 따라 변환한 릴레이션들이 서로의 기보니를 주고 받아 이를 외래키로 지정한다. 이때 관계가 가지는 속성들은 관계에
참여하는 개체를 변환한 릴레이션에 모두 포함시킨다. 이때, 일대일 관계에 참여하고 있는 개체에 해당하는 릴레이션들이 서로의 기본키를 주고받아 이를 외래키로 지정하면 불필요한 데이터 중복이 발생한다. 일대다 관계의
표현처럼 한쪽 릴레이션만 외래키를 가져도 관계를 표현하는데 충분하다. 외래키뿐 아니라 관계가 가지는 속성도 마찬가지다.

> 어떤 릴레이션을 선택하더라도 관계를 표현하는 데 문제가 없으면 어느 측에서 가지더라도 상관없다.


<br/>

### 2. 일대일 관계에 필수적으로 참여하는 개체의 릴레이션만 외래키를 받는다.

일대일 관계를 맺고 있는 두 개체 중 관계에 필수적으로 참여하는 개체에 대응하는 릴레이션에만 외래키를 포함시킨다. 즉, 관계에 필수적으로 참여하는 개체에 해당하는 릴레이션이 선택적으로 참여하는 개체에 해당하는
릴레이션의 기본키를 받아 외래키로 지정한다. 이때 관계가 가지고 있는 속성들도 관계에 필수적으로 참여하는 개체에 해당하는 릴레이션에 함께 포함시킨다.

> 관계에 선택적으로 참여하는 개체는 릴레이션이 실제로 구축되고 난 후 외래키로 지정된 속성에 널 값이 저장되는 경우가 많기 때문에 반드시 참여하는 개체에 대응하는 릴레이션이 외래키를 가지도록 하는 것이 좋다. 

일대일 관계를 맺는 두 개체가 모두 선택적으로 참여하는 경우에는 외래키를 포함시킬 릴레이션을 자유롭게 선택하면 된다. 필수적으로 참여하는 개체가 있다면 그 개체에 해당하는 릴레이션에 외래키를 포함시키면 된다. 
<br/><br/>

### 3. 모든 개체가 일대일 관계에 필수적으로 참여하는 릴레이션 하나로 합친다.

일대일 관계를 맺고 있는 두 개체가 모두 관계에 필수적으로 참여한다면 그만큼 관련성이 있는 개체라다. 따라서 두 개체에 해당하는 두 릴레이션을 하나로 합쳐 표현한다. 관계의 이름을 릴레이션의 이름으로 사용하고,
관계에 참여하는 두 개체의 속성들도 관계 릴레이션에 모두 포함시킨다. 그리고 두 개체 릴레이션의 키 속성을 조합하여 관계 릴레이션의 기본키로 지정한다. 

<br/><br/><br/><br/>

### 8-5. 다중 값 속성은 릴레이션으로 변환한다.

관계 데이터 모델의 릴레이션에서 다중 값을 가지는 속성은 허용하지 않는다. 따라서 E-R다이어그램에 있는 다중 값 속성은 그 속성을 가지고 있는 개체에 해당하는 릴레이션이 아닌 별도의 릴레이션을 만들어 포함시킨다. 새로 만들어진 릴레이션의 이름은 자유롭게 정하고, 기본키는 다중 값 속성과 외래키를 조합하여 지정한다. 