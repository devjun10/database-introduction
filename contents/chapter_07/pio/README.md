(에서 View만)

# 4. 뷰

## 1) 뷰의 개념

뷰는 다른 테이블을 기반으로 만들어진 가상 테이블

뷰는 데이터를 실제로 저장하지 않음.

뷰를 통해 기본 테이블의 내용을 쉽게 검색할 수는 있지만 기본 테이블의 내용을 바꾸는 작업은 제한적으로 이루어진다.

## 2) 뷰의 생성

```sql
CREATE VIEW 뷰_이름[(속성_리스트)]
AS SELECT ~
[WITH CHECK OPTION];
```

- 뷰를 생성할 때는 `CREATE VIEW` 명령어를 사용.
- SELECT문은 기본 테이블에 대한 SELECT문 → 생성하고자 하는 뷰의 정의를 담음 ‼️order by는 사용 불가.
- `WITH CHECK OPTION`은 뷰에 삽입, 수정 연산을 할 때 SELECT문에서 제시한 뷰의 정의조건을 위반하면 수행되지 않게 하는 **제약 조건**을 의미.

```sql
CREATE VIEW 우수고객(고객아이디, 고객이름, 나이)
	AS SELECT 고객아이디, 고객이름, 나이
			 FROM 고객
			WHERE 등급 = 'VIP'
WITH CHECK OPTION;

SELECT * FROM 우수고객;
```

![](image/img.png)


- 사실 위의 예제에서 고객 테이블의 속성과 만들려는 우수고객 뷰의 속성이 같으므로 `CREATE VIEW 우수고객(고객아이디, 고객이름, 나이)` 에서 속성은 생략해도 된다.
- 뷰 생성 쿼리문에 WITH CHECK OPTION이 추가되어있으므로 VIP등급이 아닌 고객 데이터와 관련된 삽입, 수정, 삭제 연산을 시도하면 거부된다.

예제 7-56

```sql
CREATE VIEW 업체별제품수(제조업체, 제품수)
FROM 제품
AS SELECT 제조업체, COUNT(*) <- 집계함수라는 것
GROUP BY 제조업체
WITH CHECK OPTION;

SELECT * FROM 업체별제품수;
```

‼️ View의 `제품수` 속성이 기본테이블인 제품 테이블에 원래 있던 속성이 아니라 집계 함수를 통해 새로 계산된 속성이기 때문에 뷰의 속성명을 생략할 수 없다.

## 3) 뷰의 활용

생성된 뷰에서도 일반 테이블처럼 데이터를 검색할 수 있다.

뷰가 데이터를 저장하고 있지 않는 가상테이블임에도 SELECT문으로 데이터를 조회할 수 있는 이유는, 뷰의 SELECT문이 내부적으로 **기본테이블에 대한 SELECT문으로 변환되어 수행**되기 때문.

나머지 DML 쿼리도 마찬가지로 기본테이블에 대해 수행되지만 **모든 뷰에 대해서 삽입/수정/삭제 연산이 가능한 것은 아니다.**

### **삽입/수정/삭제 연산이 불가능한 뷰란?**

1. 기본 테이블의 기본키를 구성하는 속성이 포함되지 않은 뷰.
2. 기본 테이블에 있던 애용이 아니라 집계 함수로 새로 계산된 내용을 포함하고 있는 뷰.
3. `DISTINCT` 키워드를 포함하여 정의한 뷰.
4. `GROUP BY` 절을 포함하여 정의한 뷰.
5. 여러 개의 테이블을 조인하여 정의한 뷰(는 변경할 수 없는 경우가 많다.)

→ 위 케이스들은 기본 테이블에서 어떤 튜플을 어떻게 변경해야 할지 명확히 제시하지 못한다는 공통점을 가지고 있다.

### 기본 테이블에 바로 연산하지 않고 굳이 뷰를 정의하여 사용하는 이유?

1. 쿼리를 좀 더 쉽게 작성할 수 있다.
   ex) 뷰를 만들 때 미리 WHERE로 조건을 걸어 만들어두면, 조회할 때 WHERE절 없이 조회가 가능 → SELECT FROM만으로도 조회가 가능해질 수 있다.
2. 데이터의 보안 유지에 도움이 된다.
   사용자에 따라 다르게 정의된 뷰를 제공하여 뷰에 포함되지 않은 데이터를 사용자로부터 보호 가능.
3. 데이터를 더 편리하게 관리할 수 있다.
   제공된 뷰에 포함되지 않은 기본 테이블의 다른 부분을 사용자가 시용자가 신경 쓸 필요 없다 → 사용자가 편리.

## 4) 뷰의 삭제

`DROP VIEW 뷰_이름`

뷰를 삭제하더라도 기본 테이블은 영향 받지 않는다.

‼️ 하지만 삭제하려는 뷰**를** 참조하고 있는 제약조건이 존재하면 삭제가 안됨. 따라서 삭제하려는 뷰**를** 참조하는 제약조건을 먼저 삭제해야 한다.
